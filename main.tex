\documentclass[12pt]{article}

\usepackage{sbc-template}

\usepackage{graphicx,url}

%\usepackage[brazil]{babel}
\usepackage[utf8]{inputenc}

\usepackage{amsmath}
\usepackage{physics}
\usepackage{algpseudocode}
\usepackage{algorithm}

\sloppy

\title{On improving minimal explanations for neural networks using mixed integer linear programming}

\author{Tiago Vargas Pereira de Oliveira\inst{1}, Thiago Alves Rocha\inst{1}}

\address{Instituto Federal de Educação, Ciência e Tecnologia do Ceará (IFCE) \email{tiago.vargas06@aluno.ifce.edu.br, thiago.alves@ifce.edu.br}}

\begin{document}

\maketitle

\begin{abstract}
	This meta-paper describes the style to be used in articles and short papers for SBC conferences. In both cases, abstracts should not have more than 10 lines and must be in the first page of the paper.
\end{abstract}

\section{Introduction}
% TODO: Contextualize: talk about how machine learning models are being used as black box models, but justifications/reasons would be helpful. Talk about some attempts to do this are heuristics, and therefore could be incorrect


\section{Preliminaries}

% TODO: Talk about mixed interger linear programming

% TODO: Talk about logical consequences (mention proof by contradiction on outputting the class)

% TODO: Talk about how to model a minimal explanation from a dataset


\section{Improving Minimal Explanations}

% TODO: Talk about how to improve an explanation given an minimal explanation

% TODO: Talk about sufficient and necessary explanations

Suppose we have a neural network classifier with inputs $x_1$, $x_2$, $x_3$, $x_4$, $x_5$, and possible outputs $C_1$, $C_2$, $C_3$.

Suppose, after passing $\vb{x} = \begin{bmatrix} x_1 \\ x_2 \\ x_3 \\ x_4 \\ x_5 \end{bmatrix} = \begin{bmatrix} 0.89 \\ -1.07 \\ 0.42 \\ -0.61 \\ -0.67 \end{bmatrix}$ to the classifier, we get the class $C_2$ as output, with minimal explanation $M$ as follows:

\[
M = \{x_1 = 0.89, x_3 = 0.42, x_4 = -0.61\}
\]

In this case, $x_2$ and $x_5$ are not part of the minimal explanation, meaning they can have any value and the output will still be $C_2$, as long as $x_1 = 0.89$, $x_3 = 0.42$, $x_4 = -0.61$ still holds.

We are now interested in discovering which range of values for the features $x_1$, $x_3$ and $x_4$ that still guarantees the output to be $C_2$, i.e. we are insterested in improving the minimal explanation to consist of constraints of type $c_{i-} \le x_i \le c_{i+}$.

The approach is to see if the output is still the same after walking at steps of $\epsilon$ at the vicinity of the point.
To achieve this, we iterate over $M$, treating the current constraint of type $x = c$ as $c \le x \le c$.
Then we update that constraint to be $c \le x \le c + \epsilon$, and check if this updated $M$ still guarantees the class $C_2$.
We keep incrementing $\epsilon$ to the right hand side of the constraint until we cannot guarantee the output class to remain the same, in which case the previous value is the upper end of the interval for feature $x$.
After that, we do the same for the other side of the constraint, but decrementing at steps of $\epsilon$, until we find the lower end for $x$.
In the case no steps can be taken at all, we keep the constraint as $x = c$.
In the case we step further than a bound of $x$, we cap the range at that bound.
% TODO: [on last sentence] Explain better that we cap the range **after** checking the output out

We expect the improved explanation to be a set of constraints that describe the range of each feature in the minimal explanation, such as $c - k_{-} \cdot \epsilon \le x \le c + k_{+} \cdot \epsilon$, where $k_{-}$ is the number of steps taken to the left, and $k_{+}$ is the number of steps taken to the right.

We provide an algorithm for improving a minimal explanation bellow. The line $M' \gets M$ means that $M'$ is a \emph{deep copy} of $M$.

In the context of the previous example, suppose our aim is to, after arbitrarily setting $\epsilon = 0.1$, we attempt to stretch the interval for $x_1$, first finding the upper end $0.92$:

\[
M = \{0.89 \le x_1 \le 0.92,
      x_3 = 0.42,
      x_4 = -0.61\}
\]

Then we stretch the lower end of the interval, finding $0.14$:

\[
M = \{0.14 \le x_1 \le 0.92,
      x_3 = 0.42,
      x_4 = -0.61\}
\]

Having found the range for the input $x_1$, we move on to $x_3$, where we can't step to the right:

\[
M = \{0.14 \le x_1 \le 0.92,
      0.42 \le x_3 \le 0.42,
      x_4 = -0.61\}
\]

Then we step to the left and find its lower end to be -0.51:

\[
M = \{0.14 \le x_1 \le 0.92,
      -0.51 \le x_3 \le 0.42,
      x_4 = -0.61\}
\]

And finally, we move to $x_4$, where we can't step at all:

\[
M = \{0.14 \le x_1 \le 0.92,
      -0.51 \le x_3 \le 0.42,
      x_4 = -0.61\}
\]

% TODO: Explain the notation $M \cup F \models O$

% TODO: Describe parameters

% M: Minimal explanation
% F: Set of logical formulas that describes the network
% O: Formula that describes which neuron is the greatest

\begin{algorithm}
	\caption{Improve the minimal explanation by steps}
	\begin{algorithmic}
		\Procedure{GetImprovedExplanation} {$M, F, O, \epsilon$}
			\ForAll {$c \in M$}
				\While {$M \cup F \models O$}
					\State {$M' \gets M$}
					\State {$c \texttt{.right\_hand\_side} \gets c \texttt{.right\_hand\_side} - \epsilon$}
				\EndWhile
				\State {$M \gets M'$}
				\\
				\While {$M \cup F \models O$}
					\State {$M' \gets M$}
					\State {$c \texttt{.left\_hand\_side} \gets c \texttt{.left\_hand\_side} - \epsilon$}
				\EndWhile
				\State {$M \gets M'$}
			\EndFor
			\\
			\State {\textbf{return} $M$}
		\EndProcedure
	\end{algorithmic}
\end{algorithm}

% TODO: Talk about gaps in the interval

% TODO: Put the example of the sliced square (2 inputs; 2 classes; one line dividing the square, defining the class boundaries; select a point and walk until you hit the line and notice how first walking vertically or horizontally change the results)

% TODO: Put an alternative algorithm to do 1 step per variable, as opposed to discovering the range for 1 variable then moving to the next


\section{Experiments}

% TODO: Talk about that dataset $\{A \ge 0.5 \implies 1\}$ and mention how `anchor` fails to find the boundary (0.5)

% TODO: Talk about the execution time

% TODO: Talk about the correctness


\section{Conclusion}

\section{References}

% TODO: Add actual citations

% Citations from template:
Bibliographic references must be unambiguous and uniform.  We recommend giving
the author names references in brackets, e.g. \cite{knuth:84},
\cite{boulic:91}, and \cite{smith:99}.


\bibliographystyle{sbc}
\bibliography{sbc-template}

\end{document}
